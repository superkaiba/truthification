<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scale Experiment: Agents × Rounds</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0; padding: 20px; background: #0d1117; color: #c9d1d9;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { color: #58a6ff; border-bottom: 2px solid #30363d; padding-bottom: 10px; }
        h2 { color: #8b949e; margin-top: 30px; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin: 20px 0; }
        .card { background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 15px; }
        .card h3 { margin-top: 0; color: #58a6ff; font-size: 14px; }
        .chart-container { background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 15px; margin: 15px 0; }
        .finding { background: #161b22; border-left: 3px solid #58a6ff; padding: 12px; margin: 10px 0; border-radius: 0 6px 6px 0; }
        .finding.good { border-color: #238636; }
        .finding.bad { border-color: #da3633; }
        .finding.warn { border-color: #d29922; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; margin: 20px 0; }
        th, td { padding: 12px; text-align: center; border: 1px solid #30363d; }
        th { background: #21262d; color: #58a6ff; }
        td { background: #161b22; }
        .highlight { background: #238636 !important; color: white; font-weight: bold; }
        .low { background: #da363333; }
        .back-link { color: #58a6ff; text-decoration: none; margin-bottom: 20px; display: inline-block; }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
<div class="container">
    <a href="index.html" class="back-link">← Back to Dashboard</a>
    <h1>Scale Experiment: Agents × Rounds</h1>
    <p>How does truth recovery change with more agents and longer debates?</p>
    <p><strong>Config:</strong> 10 objects, 8 oracle queries, 5 selections | <strong>Games:</strong> 24/27 completed | <strong>W&B:</strong> <a href="https://wandb.ai/thomasjiralerspong/truthification/runs/f7q8taxh" style="color: #58a6ff;">View Run</a></p>

    <h2>Key Findings</h2>
    <div class="summary-grid">
        <div class="finding good">
            <strong>More agents need more rounds</strong><br>
            4 agents improve from 19% to 44% accuracy as rounds increase from 10 to 20
        </div>
        <div class="finding bad">
            <strong>Few agents hurt by long debates</strong><br>
            2 agents drop from 46% to 37% accuracy with more rounds
        </div>
        <div class="finding good">
            <strong>Estimator outperforms judge</strong><br>
            Passive observation beats active participation by 5-24%
        </div>
        <div class="finding warn">
            <strong>4 agents at 10 rounds = worse than random</strong><br>
            18.7% accuracy vs 30.7% random baseline
        </div>
    </div>

    <h2>Judge Accuracy by Agents × Rounds</h2>
    <table>
        <tr>
            <th></th>
            <th>10 Rounds</th>
            <th>15 Rounds</th>
            <th>20 Rounds</th>
        </tr>
        <tr>
            <th>2 Agents</th>
            <td class="highlight">46.0% (±2.3%)</td>
            <td>36.7% (±5.2%)</td>
            <td>N/A*</td>
        </tr>
        <tr>
            <th>3 Agents</th>
            <td class="low">28.0%</td>
            <td>38.7% (±10.0%)</td>
            <td>30.0% (±10.1%)</td>
        </tr>
        <tr>
            <th>4 Agents</th>
            <td class="low">18.7% (±1.3%)</td>
            <td>40.7% (±8.7%)</td>
            <td class="highlight">44.0% (±9.5%)</td>
        </tr>
    </table>
    <p style="color: #8b949e; font-size: 12px;">*Rate limited - no data collected. Random baseline: 30.7%</p>

    <h2>Estimator Accuracy by Agents × Rounds</h2>
    <table>
        <tr>
            <th></th>
            <th>10 Rounds</th>
            <th>15 Rounds</th>
            <th>20 Rounds</th>
        </tr>
        <tr>
            <th>2 Agents</th>
            <td>51.3%</td>
            <td class="highlight">55.3%</td>
            <td>N/A*</td>
        </tr>
        <tr>
            <th>3 Agents</th>
            <td>52.0%</td>
            <td>44.0%</td>
            <td>50.0%</td>
        </tr>
        <tr>
            <th>4 Agents</th>
            <td>42.7%</td>
            <td>44.7%</td>
            <td class="highlight">58.7%</td>
        </tr>
    </table>

    <div class="chart-container">
        <div id="heatmap-judge"></div>
    </div>

    <div class="chart-container">
        <div id="heatmap-estimator"></div>
    </div>

    <div class="chart-container">
        <div id="line-chart"></div>
    </div>

    <div class="chart-container">
        <div id="comparison-chart"></div>
    </div>

    <h2>Interpretation</h2>
    <div class="card">
        <h3>Why do more agents initially hurt accuracy?</h3>
        <p>With more agents, there's more conflicting information. At 10 rounds, the judge doesn't have enough time to identify credibility patterns across 4 different sources.</p>
    </div>
    <div class="card">
        <h3>Why do more rounds help with more agents?</h3>
        <p>With more agents, the judge needs more rounds to: (1) observe consistency patterns, (2) cross-check claims between agents, (3) identify who is reliable. More sources = more potential information, but only if there's time to process it.</p>
    </div>
    <div class="card">
        <h3>Why does the estimator outperform the judge?</h3>
        <p>The judge actively makes selections based on agent recommendations, which may bias it toward manipulated choices. The estimator passively observes without this influence, achieving more objective truth assessment.</p>
    </div>

    <h2>All Results</h2>
    <table>
        <tr>
            <th>Condition</th>
            <th>Seed 42</th>
            <th>Seed 123</th>
            <th>Seed 456</th>
            <th>Mean Judge</th>
            <th>Mean Est</th>
        </tr>
        <tr>
            <td>2 Agents, 10 Rounds</td>
            <td>50% / 46%</td>
            <td>46% / 58%</td>
            <td>42% / 50%</td>
            <td><strong>46.0%</strong></td>
            <td><strong>51.3%</strong></td>
        </tr>
        <tr>
            <td>2 Agents, 15 Rounds</td>
            <td>36% / 54%</td>
            <td>46% / 64%</td>
            <td>28% / 48%</td>
            <td><strong>36.7%</strong></td>
            <td><strong>55.3%</strong></td>
        </tr>
        <tr>
            <td>3 Agents, 10 Rounds</td>
            <td>ERROR</td>
            <td>ERROR</td>
            <td>28% / 52%</td>
            <td><strong>28.0%</strong></td>
            <td><strong>52.0%</strong></td>
        </tr>
        <tr>
            <td>3 Agents, 15 Rounds</td>
            <td>20% / 36%</td>
            <td>42% / 50%</td>
            <td>54% / 46%</td>
            <td><strong>38.7%</strong></td>
            <td><strong>44.0%</strong></td>
        </tr>
        <tr>
            <td>3 Agents, 20 Rounds</td>
            <td>42% / 48%</td>
            <td>38% / 50%</td>
            <td>10% / 52%</td>
            <td><strong>30.0%</strong></td>
            <td><strong>50.0%</strong></td>
        </tr>
        <tr>
            <td>4 Agents, 10 Rounds</td>
            <td>16% / 36%</td>
            <td>20% / 40%</td>
            <td>20% / 52%</td>
            <td><strong>18.7%</strong></td>
            <td><strong>42.7%</strong></td>
        </tr>
        <tr>
            <td>4 Agents, 15 Rounds</td>
            <td>26% / 38%</td>
            <td>56% / 46%</td>
            <td>40% / 50%</td>
            <td><strong>40.7%</strong></td>
            <td><strong>44.7%</strong></td>
        </tr>
        <tr>
            <td>4 Agents, 20 Rounds</td>
            <td>30% / 42%</td>
            <td>62% / 72%</td>
            <td>40% / 62%</td>
            <td><strong>44.0%</strong></td>
            <td><strong>58.7%</strong></td>
        </tr>
    </table>

</div>

<script>
// Data
const agents = [2, 3, 4];
const rounds = [10, 15, 20];

const judgeData = [
    [46.0, 36.7, null],  // 2 agents
    [28.0, 38.7, 30.0],  // 3 agents
    [18.7, 40.7, 44.0]   // 4 agents
];

const estimatorData = [
    [51.3, 55.3, null],  // 2 agents
    [52.0, 44.0, 50.0],  // 3 agents
    [42.7, 44.7, 58.7]   // 4 agents
];

// Heatmap - Judge
Plotly.newPlot('heatmap-judge', [{
    z: judgeData,
    x: ['10 Rounds', '15 Rounds', '20 Rounds'],
    y: ['2 Agents', '3 Agents', '4 Agents'],
    type: 'heatmap',
    colorscale: [[0, '#da3633'], [0.5, '#d29922'], [1, '#238636']],
    zmin: 15,
    zmax: 50,
    text: judgeData.map(row => row.map(v => v ? v.toFixed(1) + '%' : 'N/A')),
    texttemplate: '%{text}',
    textfont: {color: 'white', size: 14},
    hovertemplate: '%{y}, %{x}: %{z:.1f}%<extra></extra>'
}], {
    title: {text: 'Judge Accuracy Heatmap', font: {color: '#58a6ff'}},
    paper_bgcolor: '#161b22',
    plot_bgcolor: '#161b22',
    font: {color: '#c9d1d9'},
    margin: {t: 50, b: 50, l: 100, r: 50}
});

// Heatmap - Estimator
Plotly.newPlot('heatmap-estimator', [{
    z: estimatorData,
    x: ['10 Rounds', '15 Rounds', '20 Rounds'],
    y: ['2 Agents', '3 Agents', '4 Agents'],
    type: 'heatmap',
    colorscale: [[0, '#da3633'], [0.5, '#d29922'], [1, '#238636']],
    zmin: 40,
    zmax: 60,
    text: estimatorData.map(row => row.map(v => v ? v.toFixed(1) + '%' : 'N/A')),
    texttemplate: '%{text}',
    textfont: {color: 'white', size: 14},
    hovertemplate: '%{y}, %{x}: %{z:.1f}%<extra></extra>'
}], {
    title: {text: 'Estimator Accuracy Heatmap', font: {color: '#58a6ff'}},
    paper_bgcolor: '#161b22',
    plot_bgcolor: '#161b22',
    font: {color: '#c9d1d9'},
    margin: {t: 50, b: 50, l: 100, r: 50}
});

// Line chart
Plotly.newPlot('line-chart', [
    {x: rounds, y: [46.0, 36.7, null], name: '2 Agents (Judge)', mode: 'lines+markers', line: {color: '#58a6ff', dash: 'solid'}, marker: {size: 10}},
    {x: rounds, y: [28.0, 38.7, 30.0], name: '3 Agents (Judge)', mode: 'lines+markers', line: {color: '#7ee787', dash: 'solid'}, marker: {size: 10}},
    {x: rounds, y: [18.7, 40.7, 44.0], name: '4 Agents (Judge)', mode: 'lines+markers', line: {color: '#d29922', dash: 'solid'}, marker: {size: 10}},
    {x: [10, 20], y: [30.7, 30.7], name: 'Random Baseline', mode: 'lines', line: {color: '#da3633', dash: 'dash'}}
], {
    title: {text: 'Judge Accuracy by Rounds (per Agent Count)', font: {color: '#58a6ff'}},
    xaxis: {title: 'Number of Rounds', color: '#c9d1d9', gridcolor: '#30363d'},
    yaxis: {title: 'Property Accuracy (%)', color: '#c9d1d9', gridcolor: '#30363d', range: [0, 60]},
    paper_bgcolor: '#161b22',
    plot_bgcolor: '#161b22',
    font: {color: '#c9d1d9'},
    legend: {x: 0.02, y: 0.98}
});

// Comparison chart - Judge vs Estimator
const conditions = ['2A/10R', '2A/15R', '3A/10R', '3A/15R', '3A/20R', '4A/10R', '4A/15R', '4A/20R'];
const judgeFlat = [46.0, 36.7, 28.0, 38.7, 30.0, 18.7, 40.7, 44.0];
const estFlat = [51.3, 55.3, 52.0, 44.0, 50.0, 42.7, 44.7, 58.7];

Plotly.newPlot('comparison-chart', [
    {x: conditions, y: judgeFlat, name: 'Judge', type: 'bar', marker: {color: '#58a6ff'}},
    {x: conditions, y: estFlat, name: 'Estimator', type: 'bar', marker: {color: '#7ee787'}},
    {x: conditions, y: Array(8).fill(30.7), name: 'Random Baseline', type: 'scatter', mode: 'lines', line: {color: '#da3633', dash: 'dash'}}
], {
    title: {text: 'Judge vs Estimator Accuracy by Condition', font: {color: '#58a6ff'}},
    xaxis: {title: 'Condition (Agents/Rounds)', color: '#c9d1d9'},
    yaxis: {title: 'Property Accuracy (%)', color: '#c9d1d9', gridcolor: '#30363d'},
    paper_bgcolor: '#161b22',
    plot_bgcolor: '#161b22',
    font: {color: '#c9d1d9'},
    barmode: 'group',
    legend: {x: 0.02, y: 0.98}
});
</script>
</body>
</html>
